{{ define "title" }}Dashboard - Time Tracking System{{ end }}

{{ define "content" }}
<div class="row g-4 mb-4">
  <!-- Quick Stats Cards -->
  <div class="col-md-3">
    <div class="card bg-primary text-white h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title mb-1">Total Users</h6>
            <h2 class="mb-0">{{ .Content.QuickStats.TotalUsers }}</h2>
          </div>
          <i class="bi bi-people-fill fs-1 opacity-75"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card bg-success text-white h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title mb-1">Total Hours</h6>
            <h2 class="mb-0">{{ .Content.QuickStats.TotalHours }}</h2>
          </div>
          <i class="bi bi-clock-fill fs-1 opacity-75"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card bg-info text-white h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title mb-1">Active Users</h6>
            <h2 class="mb-0">{{ .Content.QuickStats.ActiveUsers }}</h2>
          </div>
          <i class="bi bi-person-check-fill fs-1 opacity-75"></i>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-3">
    <div class="card bg-warning text-white h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title mb-1">Avg Hours/User</h6>
            <h2 class="mb-0">{{ printf "%.1f" .Content.QuickStats.AvgHoursPerUser }}</h2>
          </div>
          <i class="bi bi-graph-up fs-1 opacity-75"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Department Summary -->
  <div class="col-lg-6">
    <div class="card h-100">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
      <i class="bi bi-diagram-3 text-primary"></i> Department Summary
      {{ if .Content.SelectedDay }}<small class="text-muted ms-2">for {{ .Content.SelectedDay }}</small>{{ end }}
        </h5>
      </div>
      <div class="card-body" style="max-height: 360px; overflow-y: scroll;">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Department</th>
                <th>Users</th>
                <th>Total Hours</th>
                <th>Avg/User</th>
              </tr>
            </thead>
            <tbody>
              {{ range .Content.DepartmentSummary }}
              <tr class="{{ if eq .DepartmentName $.Content.SelectedDept }}table-active{{ end }}">
                <td>
                  <strong>
                    <a href="/dashboard?dept={{ urlquery .DepartmentName }}{{ if $.Content.SelectedDay }}&day={{ $.Content.SelectedDay }}{{ end }}" class="text-decoration-none">
                      {{ .DepartmentName }}
                    </a>
                  </strong>
                </td>
                <td><span class="badge bg-secondary">{{ .TotalUsers }}</span></td>
                <td><span class="text-success fw-bold">{{ printf "%.1f" .TotalHours }}</span></td>
                <td><span class="text-info">{{ printf "%.1f" .AvgHoursPerUser }}</span></td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Time Tracking Trends -->
  <div class="col-lg-6">
    <div class="card h-100">
  <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
          <i class="bi bi-calendar-week text-success"></i> Last 30 Days Trends
        </h5>
      </div>
      <div class="card-body" style="max-height: 360px; overflow-y: scroll;">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Date</th>
                <th>Hours</th>
                <th>Users</th>
                <th>Work</th>
                <th>Break</th>
              </tr>
            </thead>
            <tbody>
              {{ range .Content.TimeTrends }}
              <tr class="{{ if eq .Date $.Content.SelectedDay }}table-active{{ end }}">
                <td>
                  <small>
                    <a href="/dashboard?day={{ .Date }}{{ if $.Content.SelectedDept }}&dept={{ urlquery $.Content.SelectedDept }}{{ end }}" class="text-decoration-none">
                      {{ fmtDT .Date }}
                    </a>
                  </small>
                </td>
                <td><span class="text-success fw-bold">{{ printf "%.1f" .TotalHours }}</span></td>
                <td><span class="badge bg-info">{{ .ActiveUsers }}</span></td>
                <td><span class="badge bg-success">{{ .WorkEntries }}</span></td>
                <td><span class="badge bg-warning">{{ .BreakEntries }}</span></td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- User Activity Summary -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
      <i class="bi bi-person-lines-fill text-info"></i> User Activity Summary
      {{ if .Content.SelectedDept }}<small class="text-muted ms-2">for {{ .Content.SelectedDept }}</small>{{ end }}
      {{ if .Content.SelectedDay }}<small class="text-muted ms-2">on {{ .Content.SelectedDay }}</small>{{ end }}
        </h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>User</th>
                <th>Department</th>
                <th>Work Hours</th>
                <th>Break Hours</th>
                <th>Last Activity</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {{ range .Content.UserActivity }}
              <tr>
                <td><strong>{{ .UserName }}</strong></td>
                <td><span class="badge bg-secondary">{{ .Department }}</span></td>
                <td><span class="text-success fw-bold">{{ printf "%.1f" .TotalWorkHours }}</span></td>
                <td><span class="text-warning">{{ printf "%.1f" .TotalBreakHours }}</span></td>
                <td><small>{{ fmtDT .LastActivity }}</small></td>
                <td>
                  {{ if eq .Status "Work" }}
                    <span class="badge bg-success">Working</span>
                  {{ else if eq .Status "Break" }}
                    <span class="badge bg-warning">On Break</span>
                  {{ else }}
                    <span class="badge bg-secondary">{{ .Status }}</span>
                  {{ end }}
                </td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>
        {{ if and .Content.SelectedDept .Content.SelectedDay }}
        <hr>
        <h6 class="mt-3">Detailed entries for {{ .Content.SelectedDept }} on {{ .Content.SelectedDay }}</h6>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>User</th>
                <th>Activity</th>
                <th>Start</th>
                <th>End</th>
                <th>Dur. (h)</th>
                <th>Comment</th>
              </tr>
            </thead>
            <tbody>
              {{ range .Content.UserDayDetails }}
              <tr>
                <td>{{ .UserName }}</td>
                <td>
                  {{ if eq .Activity "Work" }}
                    <span class="badge bg-success">{{ .Activity }}</span>
                  {{ else if eq .Activity "Break" }}
                    <span class="badge bg-warning">{{ .Activity }}</span>
                  {{ else }}
                    <span class="badge bg-secondary">{{ .Activity }}</span>
                  {{ end }}
                </td>
                <td><small>{{ fmtDT .Start }}</small></td>
                <td><small>{{ fmtDT .End }}</small></td>
                <td>{{ printf "%.2f" .Duration }}</td>
                <td>{{ .Comment }}</td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>
        {{ end }}
      </div>
    </div>
  </div>
</div>
{{ end }}



